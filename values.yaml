# Default values for nebari-data-science-pack
# This is a YAML-formatted file.

# Shared storage configuration (disabled - requires RWX storage class)
sharedStorage:
  enabled: false
  storageClass: ""  # Leave empty to use cluster default
  size: 10Gi
  accessModes:
    - ReadWriteMany

# JupyterHub configuration
# All values under this key are passed to the jupyterhub subchart
jupyterhub:
  hub:
    # Custom Nebari hub image with jhub-apps pre-installed
    image:
      name: quay.io/nebari/nebari-data-science-pack-jupyterhub@sha256
      tag: "4a3ddf08d87736d3de5a8d1d520ed5038e3bd3c0d4e029cd3452e7e7fbced3a2"

    config:
      JupyterHub:
        admin_access: true
        # Default authenticator for local development - any username/password works
        # For production, use GenericOAuthenticator with Keycloak (see below)
        authenticator_class: dummy

      # ============================================================
      # Optional: Keycloak/OAuth Configuration
      # ============================================================
      # To enable OAuth authentication with Keycloak or another IdP,
      # uncomment and configure the following section:
      #
      # JupyterHub:
      #   authenticator_class: generic-oauth
      #
      # GenericOAuthenticator:
      #   client_id: jupyterhub
      #   client_secret: <your-client-secret>
      #   oauth_callback_url: https://<your-domain>/hub/oauth_callback
      #   authorize_url: https://<keycloak-host>/realms/<realm>/protocol/openid-connect/auth
      #   token_url: https://<keycloak-host>/realms/<realm>/protocol/openid-connect/token
      #   userdata_url: https://<keycloak-host>/realms/<realm>/protocol/openid-connect/userinfo
      #   login_service: "Keycloak"
      #   username_claim: "preferred_username"
      #   scope:
      #     - openid
      #     - profile
      #     - email
      # ============================================================

    # Mount custom config files from ConfigMap
    extraVolumes:
      - name: custom-config
        configMap:
          name: data-science-pack-hub-config

    extraVolumeMounts:
      - name: custom-config
        mountPath: /usr/local/etc/jupyterhub/jupyterhub_config.d/

    service:
      extraPorts:
        - port: 10202
          targetPort: 10202
          name: jhub-apps

    networkPolicy:
      enabled: true
      ingress:
        - ports:
            - port: 10202  # jhub-apps service port

  singleuser:
    image:
      name: quay.io/nebari/nebari-data-science-pack-jupyterlab@sha256
      tag: "640dd856078b880e1600a8834eb1f0e7c86909c5368a38bd2df5c50c20ea7d31"
    defaultUrl: "/lab"
    extraEnv:
      JUPYTERHUB_SINGLEUSER_APP: "jupyter_server.serverapp.ServerApp"

    # Storage configuration - use "none" to avoid dict format incompatibility with Nebari hub image
    storage:
      type: none

  proxy:
    service:
      type: ClusterIP
    chp:
      networkPolicy:
        egress:
          - ports:
              - port: 10202
                protocol: TCP

  scheduling:
    userScheduler:
      enabled: false

  cull:
    enabled: true
    timeout: 3600
    every: 300
